syntax = "proto3";

package noble.dollar.vaults.v2;

import "amino/amino.proto";
import "cosmos_proto/cosmos.proto";
import "gogoproto/gogo.proto";
import "noble/dollar/vaults/v2/nav.proto";
import "noble/dollar/vaults/v2/vaults.proto";

option go_package = "dollar.noble.xyz/v2/types/vaults/v2";

// GenesisState defines the V2 vaults module's genesis state
message GenesisState {
  // Module parameters
  Params params = 1 [(gogoproto.nullable) = false];

  // V2 vault configurations
  VaultConfig vault_config = 2 [(gogoproto.nullable) = false];

  // All user positions in V2
  repeated UserPositionEntry user_positions = 3 [(gogoproto.nullable) = false];

  // Current NAV information for each vault type
  repeated NAVEntry nav_entries = 4 [(gogoproto.nullable) = false];

  // Exit queue entries
  repeated ExitRequestEntry exit_queue = 5 [(gogoproto.nullable) = false];

  // Total deposits and yield
  VaultTotalEntry vault_totals = 6 [(gogoproto.nullable) = false];

  // Vault statistics
  VaultStatsEntry vault_stats = 7 [(gogoproto.nullable) = false];
}

// Params defines the parameters for the V2 vaults module
message Params {
  // Authority address that can update parameters
  string authority = 1 [(cosmos_proto.scalar) = "cosmos.AddressString"];

  // Minimum deposit amount
  string min_deposit_amount = 2 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];

  // Minimum withdrawal amount
  string min_withdrawal_amount = 3 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];

  // Maximum NAV change percentage allowed per update (basis points)
  int32 max_nav_change_bps = 4;

  // Exit request timeout duration (in seconds)
  int64 exit_request_timeout = 5;

  // Maximum number of exit requests to process per block
  int32 max_exit_requests_per_block = 6;

  // Whether V2 vault are enabled
  bool vault_enabled = 7;
}

// VaultConfig stores configuration for a specific vault type
message VaultConfig {
  // Whether this vault type is enabled for new deposits
  bool enabled = 1;

  // Maximum total deposits allowed
  string max_total_deposits = 2 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];

  // Target yield rate (informational)
  string target_yield_rate = 3 [
    (cosmos_proto.scalar) = "cosmos.Dec",
    (gogoproto.customtype) = "cosmossdk.io/math.LegacyDec",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];
}

// UserPositionEntry stores a user's position in the V2 system
message UserPositionEntry {
  // User address
  bytes address = 1;

  // User position details
  UserPosition position = 2 [(gogoproto.nullable) = false];
}

// NAVEntry stores NAV information for a vault type
message NAVEntry {
  // NAV information
  NAVInfo nav_info = 1 [(gogoproto.nullable) = false];
}

// ExitRequestEntry stores an exit request in the queue
message ExitRequestEntry {
  // User address
  bytes address = 1;

  // Exit request details
  WithdrawalRequest exit_request = 2 [(gogoproto.nullable) = false];
}

// VaultTotalEntry tracks total deposits and yield for a vault type
message VaultTotalEntry {
  // Total deposits in the vault
  string total_deposits = 1 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];

  // Total accrued yield
  string total_accrued_yield = 2 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];

  // Total NAV (Net Asset Value = deposits + yield)
  string total_nav = 3 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];
}

// VaultStatsEntry tracks statistics for a vault type
message VaultStatsEntry {
  // Total number of depositors
  uint64 total_depositors = 1;

  // Total value deposited (cumulative)
  string total_deposited = 2 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];

  // Total value withdrawn (cumulative)
  string total_withdrawn = 3 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];

  // Total fees collected
  string total_fees_collected = 4 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];

  // Total yield distributed
  string total_yield_distributed = 5 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];

  // Number of active positions
  uint64 active_positions = 6;
}
