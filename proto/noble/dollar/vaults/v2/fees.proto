syntax = "proto3";

package noble.dollar.vaults.v2;

import "amino/amino.proto";
import "cosmos_proto/cosmos.proto";
import "gogoproto/gogo.proto";
import "google/protobuf/timestamp.proto";

option go_package = "dollar.noble.xyz/v2/types/vaults/v2";

// FeeType defines the different types of fees that can be collected
enum FeeType {
  option (gogoproto.goproto_enum_prefix) = false;

  // Management fee charged periodically
  FEE_TYPE_MANAGEMENT = 0;
  // Performance fee on positive returns
  FEE_TYPE_PERFORMANCE = 1;
  // Cross-chain operation fee
  FEE_TYPE_CROSS_CHAIN = 2;
  // Emergency operation fee
  FEE_TYPE_EMERGENCY = 3;
}

// FeeConfig defines the configuration for various fees
message FeeConfig {
  // Management fee rate (annual basis points)
  int32 management_fee_rate = 1;
  // Performance fee rate (basis points)
  int32 performance_fee_rate = 2;
  // Cross-chain operation fee rate (basis points)
  int32 cross_chain_fee_rate = 3;
  // Emergency operation fee rate (basis points)
  int32 emergency_fee_rate = 4;

  // Fee recipient address
  string fee_recipient = 5 [(cosmos_proto.scalar) = "cosmos.AddressString"];
  // Whether fees are enabled
  bool fees_enabled = 6;

  // High water mark for performance fees
  string high_water_mark = 7 [
    (cosmos_proto.scalar) = "cosmos.Dec",
    (gogoproto.customtype) = "cosmossdk.io/math.LegacyDec",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];
}



// YieldDeductionParams defines parameters for fee collection from yield
message YieldDeductionParams {
  // Target fee rate on yield (basis points)
  int32 yield_fee_rate = 1;
  // Minimum fee amount per period
  string min_fee_amount = 2 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];
  // Maximum fee amount per period
  string max_fee_amount = 3 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];
  // Fee collection frequency (seconds)
  int64 collection_frequency = 4;
  // Last collection timestamp
  google.protobuf.Timestamp last_collection = 5 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
}

// FeeAccrual represents accrued fees for a specific period
message FeeAccrual {
  // Fee type
  FeeType fee_type = 1;
  // Accrued amount
  string accrued_amount = 2 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];
  // Yield to be deducted for this fee
  string yield_to_deduct = 3 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];
  // Accrual period start
  google.protobuf.Timestamp period_start = 4 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
  // Accrual period end
  google.protobuf.Timestamp period_end = 5 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
  // Whether this accrual has been collected
  bool collected = 6;
}

// FeeCollection represents a completed fee collection event
message FeeCollection {
  // Collection timestamp
  google.protobuf.Timestamp timestamp = 1 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
  // Total fee amount collected
  string total_amount = 2 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];
  // Yield deducted for collection
  string yield_deducted = 3 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];
  // Breakdown by fee type
  repeated FeeTypeBreakdown breakdown = 4;
  // Block height when collected
  int64 block_height = 5;
}

// FeeTypeBreakdown provides details for each fee type in a collection
message FeeTypeBreakdown {
  // Fee type
  FeeType fee_type = 1;
  // Amount for this fee type
  string amount = 2 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];
  // Yield deducted for this fee type
  string yield_deducted = 3 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];
  // Fee rate applied (basis points)
  int32 rate_applied = 4;
}

// FeeStats provides statistics about fee collection
message FeeStats {
  // Total fees collected (all time)
  string total_fees_collected = 1 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];
  // Total yield collected for fees
  string total_yield_collected = 2 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];
  // Current annualized fee rate (basis points)
  int32 current_annual_rate = 3;
  // Last fee collection timestamp
  google.protobuf.Timestamp last_collection = 4 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
  // Average daily fee collection
  string avg_daily_collection = 5 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];
  // Fee collection frequency (seconds)
  int64 collection_frequency = 6;
}

// PerformanceFeeState tracks performance fee calculations
message PerformanceFeeState {
  // Current high water mark (total NAV)
  string high_water_mark = 1 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];
  // Last performance fee calculation
  google.protobuf.Timestamp last_calculation = 2 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
  // Current period start (for performance measurement)
  google.protobuf.Timestamp period_start = 3 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
  // Accrued performance fees (not yet collected)
  string accrued_performance_fees = 4 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];
  // Whether performance fees are currently active
  bool active = 5;
}

// FeeExemption represents an exemption from certain fees for specific addresses
message FeeExemption {
  // Exempt address
  bytes address = 1;
  // Exempted fee types
  repeated FeeType exempted_types = 2;
  // Exemption expiry (if applicable)
  google.protobuf.Timestamp expiry = 3 [
    (gogoproto.nullable) = true,
    (gogoproto.stdtime) = true
  ];
  // Exemption reason
  string reason = 4;
  // Whether exemption is active
  bool active = 5;
}

// FeeSchedule defines time-based fee rate changes
message FeeSchedule {
  // Effective date for the fee rates
  google.protobuf.Timestamp effective_date = 1 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
  // Fee configuration for this schedule
  FeeConfig fee_config = 2;
  // Whether this schedule is active
  bool active = 3;
  // Description of the schedule change
  string description = 4;
}
