syntax = "proto3";

package noble.dollar.vaults.v2;

import "amino/amino.proto";
import "cosmos_proto/cosmos.proto";
import "gogoproto/gogo.proto";
import "google/protobuf/timestamp.proto";

option go_package = "dollar.noble.xyz/v3/types/vaults/v2";

// EventDeposit is emitted when a user deposits into the V2 vault
message EventDeposit {
  // User address making the deposit
  string depositor = 1 [(cosmos_proto.scalar) = "cosmos.AddressString"];

  // Amount deposited
  string amount_deposited = 2 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];

  // Block height
  int64 block_height = 3;

  // Timestamp
  google.protobuf.Timestamp timestamp = 4 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
}

// EventWithdraw is emitted when a user withdraws from the V2 vault
message EventWithdraw {
  // User address making the withdrawal
  string withdrawer = 1 [(cosmos_proto.scalar) = "cosmos.AddressString"];

  // Principal withdrawn
  string principal_withdrawn = 2 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];

  // Yield withdrawn
  string yield_withdrawn = 3 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];

  // Total amount received (principal + yield - fees)
  string total_amount_received = 4 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];

  // Fees paid
  string fees_paid = 5 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];

  // Block height
  int64 block_height = 6;

  // Timestamp
  google.protobuf.Timestamp timestamp = 7 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
}

// EventWithdrawlRequested is emitted when a user requests a withdrawal from the V2 vault
message EventWithdrawlRequested {
  // User address requesting withdrawal
  string requester = 1 [(cosmos_proto.scalar) = "cosmos.AddressString"];

  // Amount to withdraw (principal + yield)
  string amount_to_withdraw = 2 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];

  // Withdrawal request ID
  string withdrawal_request_id = 3;

  // Expected unlock time
  google.protobuf.Timestamp expected_unlock_time = 4 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];

  // Block height
  int64 block_height = 5;

  // Timestamp
  google.protobuf.Timestamp timestamp = 6 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
}

// EventWithdrawalCancelled is emitted when a user cancels a withdrawal request
message EventWithdrawalCancelled {
  // User address cancelling withdrawal
  string requester = 1 [(cosmos_proto.scalar) = "cosmos.AddressString"];

  // Withdrawal request ID that was cancelled
  string withdrawal_request_id = 2;

  // Amount returned to active position
  string amount_returned = 3 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];

  // Block height
  int64 block_height = 4;

  // Timestamp
  google.protobuf.Timestamp timestamp = 5 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
}

// EventWithdrawalProcessed is emitted when withdrawal requests are processed
message EventWithdrawalProcessed {
  // Number of withdrawal requests processed
  int32 requests_processed = 1;

  // Total amount processed
  string total_amount_processed = 2 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];

  // Total amount distributed
  string total_amount_distributed = 3 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];

  // Block height
  int64 block_height = 4;

  // Timestamp
  google.protobuf.Timestamp timestamp = 5 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
}

// EventNAVUpdated is emitted when NAV is updated for a vault
message EventNAVUpdated {
  // Previous NAV
  string previous_nav = 1 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];

  // New NAV
  string new_nav = 2 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];

  // NAV change percentage (basis points)
  int32 change_bps = 3;

  // Total deposits in vault
  string total_deposits = 4 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];

  // Total accrued yield
  string total_accrued_yield = 5 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];

  // Authority that updated NAV
  string authority = 6 [(cosmos_proto.scalar) = "cosmos.AddressString"];

  // Update reason
  string reason = 7;

  // Block height
  int64 block_height = 8;

  // Timestamp
  google.protobuf.Timestamp timestamp = 9 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
}

// EventAccountingUpdated is emitted when vault accounting is updated
message EventAccountingUpdated {
  // Number of positions processed in this call
  uint64 positions_processed = 1;

  // Total positions processed in this accounting session
  uint64 total_positions_processed = 2;

  // Total positions in the system
  uint64 total_positions = 3;

  // Whether accounting is complete for this session
  bool complete = 4;

  // NAV value applied in this accounting update
  string applied_nav = 5 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];

  // Total yield distributed in this call
  string yield_distributed = 6 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];

  // Manager that triggered the accounting
  string manager = 7 [(cosmos_proto.scalar) = "cosmos.AddressString"];

  // Block height
  int64 block_height = 8;

  // Timestamp
  google.protobuf.Timestamp timestamp = 9 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
}

// EventFeeCollected is emitted when fees are collected
message EventFeeCollected {
  // Fee type (deposit, withdrawal, etc.)
  string fee_type = 1;

  // Amount collected
  string amount_collected = 2 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];

  // Fee rate used (basis points)
  int32 fee_rate_bps = 3;

  // User who triggered the fee
  string payer = 4 [(cosmos_proto.scalar) = "cosmos.AddressString"];

  // Block height
  int64 block_height = 5;

  // Timestamp
  google.protobuf.Timestamp timestamp = 6 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
}

// EventYieldPreferenceUpdated is emitted when a user updates their yield preference
message EventYieldPreferenceUpdated {
  // User address
  string user = 1 [(cosmos_proto.scalar) = "cosmos.AddressString"];

  // Position ID that was updated
  uint64 position_id = 2;

  // Previous yield preference
  bool previous_yield_preference = 3;

  // New yield preference
  bool new_yield_preference = 4;

  // Block height
  int64 block_height = 5;

  // Timestamp
  google.protobuf.Timestamp timestamp = 6 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
}

// EventVaultConfigUpdated is emitted when vault configuration is updated
message EventVaultConfigUpdated {
  // Previous config (JSON serialized)
  string previous_config = 1;

  // New config (JSON serialized)
  string new_config = 2;

  // Authority that made the update
  string authority = 3 [(cosmos_proto.scalar) = "cosmos.AddressString"];

  // Update reason
  string reason = 4;

  // Block height
  int64 block_height = 5;

  // Timestamp
  google.protobuf.Timestamp timestamp = 6 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
}

// EventInflightFundCreated is emitted when an inflight fund operation is initiated
message EventInflightFundCreated {
  // Transaction ID
  string transaction_id = 1;

  // Route ID
  uint32 route_id = 2;

  // Operation type (DEPOSIT_TO_POSITION, WITHDRAWAL_FROM_POSITION, etc.)
  string operation_type = 3;

  // Amount
  string amount = 4 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];

  // Value at initiation
  string value_at_initiation = 5 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];

  // Initiator address
  string initiator = 6 [(cosmos_proto.scalar) = "cosmos.AddressString"];

  // Source chain
  string source_chain = 7;

  // Destination chain
  string destination_chain = 8;

  // Expected completion time
  google.protobuf.Timestamp expected_at = 9 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];

  // Block height
  int64 block_height = 10;

  // Timestamp
  google.protobuf.Timestamp timestamp = 11 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
}

// EventInflightFundStatusChanged is emitted when an inflight fund's status changes
message EventInflightFundStatusChanged {
  // Transaction ID
  string transaction_id = 1;

  // Route ID
  uint32 route_id = 2;

  // Previous status
  string previous_status = 3;

  // New status
  string new_status = 4;

  // Amount
  string amount = 5 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];

  // Status change reason
  string reason = 6;

  // Block height
  int64 block_height = 7;

  // Timestamp
  google.protobuf.Timestamp timestamp = 8 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
}

// EventInflightFundCompleted is emitted when an inflight fund operation completes
message EventInflightFundCompleted {
  // Transaction ID
  string transaction_id = 1;

  // Route ID
  uint32 route_id = 2;

  // Operation type
  string operation_type = 3;

  // Final amount
  string final_amount = 4 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];

  // Initial amount
  string initial_amount = 5 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];

  // Time taken (seconds)
  int64 duration_seconds = 6;

  // Block height
  int64 block_height = 7;

  // Timestamp
  google.protobuf.Timestamp timestamp = 8 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
}

// EventInflightFundStale is emitted when an inflight fund is detected as stale
message EventInflightFundStale {
  // Transaction ID
  string transaction_id = 1;

  // Route ID
  uint32 route_id = 2;

  // Amount
  string amount = 3 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];

  // Hours overdue
  int64 hours_overdue = 4;

  // Expected completion time
  google.protobuf.Timestamp expected_at = 5 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];

  // Current status
  string current_status = 6;

  // Recommended action
  string recommended_action = 7;

  // Block height
  int64 block_height = 8;

  // Timestamp
  google.protobuf.Timestamp timestamp = 9 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
}

// EventInflightFundCleaned is emitted when a stale inflight fund is cleaned up
message EventInflightFundCleaned {
  // Transaction ID
  string transaction_id = 1;

  // Route ID
  uint32 route_id = 2;

  // Amount returned to vault
  string amount_returned = 3 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];

  // Reason for cleanup
  string reason = 4;

  // Authority that triggered cleanup
  string authority = 5 [(cosmos_proto.scalar) = "cosmos.AddressString"];

  // Block height
  int64 block_height = 6;

  // Timestamp
  google.protobuf.Timestamp timestamp = 7 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
}

// EventRouteCapacityExceeded is emitted when a route's capacity limit is reached
message EventRouteCapacityExceeded {
  // Route ID
  uint32 route_id = 1;

  // Current inflight value
  string current_inflight_value = 2 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];

  // Route capacity limit
  string capacity_limit = 3 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];

  // Attempted operation amount
  string attempted_amount = 4 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];

  // Block height
  int64 block_height = 5;

  // Timestamp
  google.protobuf.Timestamp timestamp = 6 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
}
