syntax = "proto3";

package noble.dollar.vaults.v2;

import "amino/amino.proto";
import "cosmos_proto/cosmos.proto";
import "gogoproto/gogo.proto";
import "google/protobuf/timestamp.proto";

option go_package = "dollar.noble.xyz/v3/types/vaults/v2";

// AUMInfo represents current AUM information for a vault
message AUMInfo {
  // Current AUM value
  string current_aum = 1 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];

  // Previous AUM value
  string previous_aum = 2 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];

  // Last update timestamp
  google.protobuf.Timestamp last_update = 3 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];
}

// CircuitBreakerTrip records when a circuit breaker was triggered
message CircuitBreakerTrip {
  // AUM change that triggered the circuit breaker (basis points)
  int32 change_bps = 1;

  // Remote position ID that caused the circuit breaker to trigger
  uint64 remote_position_id = 2;

  // Timestamp when circuit breaker was triggered
  google.protobuf.Timestamp triggered_at = 3 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];

  // Previous AUM before the change
  string previous_aum = 4 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];

  // Attempted new AUM that triggered the breaker
  string attempted_aum = 5 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];
}

// AUMUpdate represents a AUM update event
message AUMUpdate {
  // New AUM point
  string new_aum = 1 [
    (cosmos_proto.scalar) = "cosmos.Int",
    (gogoproto.customtype) = "cosmossdk.io/math.Int",
    (gogoproto.nullable) = false,
    (amino.dont_omitempty) = true
  ];

  // Update timestamp
  google.protobuf.Timestamp timestamp = 2 [
    (gogoproto.nullable) = false,
    (gogoproto.stdtime) = true
  ];

  // Block height
  int64 block_height = 3;
}
